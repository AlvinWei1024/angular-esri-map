!function(e){"use strict";e.module("esri.map",[]),e.module("esri.map").factory("esriLoader",["$q",function(e){return function(t){var n=e.defer();return require([t],function(e){e?n.resolve(e):n.reject("Couldn't load "+t)}),n.promise}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriMap",["$q","$timeout","esriLoader",function(e,t,n){function r(e,t){var n=e.$root.$$phase;"$apply"===n||"$digest"===n?e.$eval(t):e.$apply(t)}function o(e){return Math.max(Math.floor(e/2)-2,0)}return{restrict:"E",scope:{center:"=",zoom:"=",basemap:"@",load:"&",extentChange:"&"},compile:function(e,t){return e.removeAttr("id"),e.append("<div id="+t.id+"></div>"),function(){}},controller:["$scope","$element","$attrs",function(a,i,c){var u,l,s,d=e.defer(),f={};c.extent?f.extent=a[c.extent]:(a.center.lng&&a.center.lat?f.center=[a.center.lng,a.center.lat]:a.center&&(f.center=a.center),a.zoom&&(f.zoom=a.zoom)),a.basemap&&(f.basemap=a.basemap),n("esri/map").then(function(e){var n=new e(c.id,f);d.resolve(n),n.on("load",function(){c.load&&a.$apply(function(){a.load()(n)})}),a.$watch("basemap",function(e,t){n.loaded&&e!==t&&n.setBasemap(e)}),a.$watch("center.lng",function(e,r){var i=o(a.zoom);n.loaded&&e&&r&&e.toFixed(i)!==r.toFixed(i)&&a.center.lat&&(u&&t.cancel(u),s=e,u=t(function(){n.centerAt([s,l||a.center.lat]),s=null,l=null},500))}),a.$watch("center.lat",function(e,r){var i=o(a.zoom);n.loaded&&e&&r&&e.toFixed(i)!==r.toFixed(i)&&a.center.lng&&(u&&t.cancel(u),l=e,u=t(function(){n.centerAt([s||a.center.lng,l]),s=null,l=null},500))}),a.$watch("zoom",function(e,t){n.loaded&&e!==t&&n.setZoom(e)}),n.on("extent-change",function(e){r(a,function(){var t,r;a.zoom=n.getZoom(),r=o(a.zoom),n.geographicExtent&&(t=n.geographicExtent.getCenter(),a.center.lng.toFixed(r)!==t.x.toFixed(r)&&(a.center.lng=t.x),a.center.lat.toFixed(r)!==t.y.toFixed(r)&&(a.center.lat=t.y)),c.extentChange&&a.extentChange()(e)})}),a.$on("$destroy",function(){n.destroy()})}),this.getMap=function(){return d.promise},this.addLayer=function(e){return this.getMap().then(function(t){return t.addLayer(e)})},this.addLayerInfo=function(e){this.layerInfos?this.layerInfos.push(e):this.layerInfos=[e]},this.getLayerInfos=function(){return this.layerInfos}}]}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriFeatureLayer",["$q",function(e){return{restrict:"E",require:["esriFeatureLayer","^esriMap"],replace:!0,controller:["$scope","$element","$attrs",function(t,n,r){var o=e.defer();require(["esri/layers/FeatureLayer"],function(e){var t=new e(r.url);o.resolve(t)}),this.getLayer=function(){return o.promise}}],link:function(e,t,n,r){var o=r[0],a=r[1];o.getLayer().then(function(e){return a.addLayer(e),a.addLayerInfo({title:n.title||e.name,layer:e,hideLayers:n.hideLayers?n.hideLayers.split(","):void 0,defaultSymbol:n.defaultSymbol?JSON.parse(n.defaultSymbol):!0}),e})}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriLegend",["$document","$q",function(t,n){return{priority:-10,scope:{},replace:!0,require:["^esriMap"],link:function(t,r,o,a){var i=a[0],c=o.targetId||o.id,u=n.defer();require(["esri/dijit/Legend","dijit/registry"],function(n,r){i.getMap().then(function(o){var a={map:o},l=i.getLayerInfos();l&&(a.layerInfos=l);var s=r.byId(c);s&&s.destroyRecursive(),s=new n(a,c),s.startup(),t.layers=s.layers,e.forEach(t.layers,function(e,n){t.$watch("layers["+n+"].renderer",function(){s.refresh()})}),u.resolve(s)})})}}}])}(angular);