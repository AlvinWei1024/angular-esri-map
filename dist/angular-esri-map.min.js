angular.module("esri.map",[]).directive("esriMap",["$q",function(e){return{restrict:"E",scope:{basemap:"=",center:"=",zoom:"="},compile:function(e,r){return e.removeAttr("id"),e.append("<div id="+r.id+"></div>"),function(){}},controller:["$scope","$element","$attrs",function(r,t,n){var a=e.defer(),i={};n.extent&&(i.extent=r[n.extent]),r.center?i.center=r.center.split(","):n.lng&&n.lat&&(i.center=[n.lng,n.lat]),r.zoom&&(i.zoom=r.zoom),r.basemap&&(i.basemap=r.basemap),require(["esri/map"],function(e){var t=new e(n.id,i);a.resolve(t),r.$watch("basemap",function(e){t.loaded&&t.setBasemap(e)}),r.$watch("zoom",function(e){t.loaded&&t.setZoom(e)}),t.on("extent-change",function(){r.$apply(function(){r.zoom=t.getZoom()})})}),this.getMap=function(){return a.promise},this.addLayer=function(e){return this.getMap().then(function(r){return r.addLayer(e)})},this.addLayerInfo=function(e){this.layerInfos?this.layerInfos.push(e):this.layerInfos=[e]},this.getLayerInfos=function(){return this.layerInfos}}]}}]),angular.module("esri.map").directive("esriFeatureLayer",["$q",function(e){return{restrict:"E",require:["esriFeatureLayer","^esriMap"],replace:!0,controller:["$scope","$element","$attrs",function(r,t,n){var a=e.defer();require(["esri/layers/FeatureLayer"],function(e){var r=new e(n.url);a.resolve(r)}),this.getLayer=function(){return a.promise}}],link:function(e,r,t,n){var a=n[0],i=n[1];a.getLayer().then(function(e){return i.addLayer(e),i.addLayerInfo({title:t.title||e.name,layer:e,hideLayers:t.hideLayers?t.hideLayers.split(","):void 0,defaultSymbol:t.defaultSymbol?JSON.parse(t.defaultSymbol):!0}),e})}}}]),angular.module("esri.map").directive("esriLegend",["$document","$q",function(e,r){return{priority:-10,scope:{},replace:!0,require:["^esriMap"],link:function(e,t,n,a){var i=a[0],o=n.targetId||n.id,s=r.defer();require(["esri/dijit/Legend","dijit/registry"],function(r,t){i.getMap().then(function(n){var a={map:n},u=i.getLayerInfos();u&&(a.layerInfos=u);var c=t.byId(o);c&&c.destroyRecursive(),c=new r(a,o),c.startup(),e.layers=c.layers,angular.forEach(e.layers,function(r,t){e.$watch("layers["+t+"].renderer",function(){c.refresh()})}),s.resolve(c)})})}}}]);