!function(e){"use strict";e.module("esri.map",[]),e.module("esri.map").factory("esriLoader",["$q",function(e){return function(t){var r=e.defer();return require([t],function(e){e?r.resolve(e):r.reject("Couldn't load "+t)}),r.promise}}])}(angular),function(e){"use strict";e.module("esri.map").service("esriRegistry",["$q",function(e){var t={};return{_register:function(r,n){t[r]||(t[r]=e.defer());var o=t[r];return n.promise.then(function(e){return o.resolve(e),e},function(e){return o.reject(e),e}),function(){delete t[r]}},get:function(r){if(t[r])return t[r].promise;var n=e.defer();return t[r]=n,n.promise}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriMap",["$q","$timeout","esriLoader","esriRegistry",function(e,t,r,n){function o(e,t){var r=e.$root.$$phase;"$apply"===r||"$digest"===r?e.$eval(t):e.$apply(t)}function i(e){return Math.max(Math.floor(e/2)-2,0)}return{restrict:"E",scope:{center:"=",zoom:"=",basemap:"@",load:"&",extentChange:"&"},compile:function(e,t){return e.removeAttr("id"),e.append("<div id="+t.id+"></div>"),function(){}},controller:["$scope","$element","$attrs",function(a,c,u){var s=e.defer();if(u.registerAs){var l=n._register(u.registerAs,s);a.$on("$destroy",l)}var d,f,p,m={};u.extent?m.extent=a[u.extent]:(a.center.lng&&a.center.lat?m.center=[a.center.lng,a.center.lat]:a.center&&(m.center=a.center),a.zoom&&(m.zoom=a.zoom)),a.basemap&&(m.basemap=a.basemap),r("esri/map").then(function(e){var r=new e(u.id,m);s.resolve(r),r.on("load",function(){u.load&&a.$apply(function(){a.load()(r)})}),a.$watch("basemap",function(e,t){r.loaded&&e!==t&&r.setBasemap(e)}),a.$watch("center.lng",function(e,n){var o=i(a.zoom);r.loaded&&e&&n&&e.toFixed(o)!==n.toFixed(o)&&a.center.lat&&(d&&t.cancel(d),p=e,d=t(function(){r.centerAt([p,f||a.center.lat]),p=null,f=null},500))}),a.$watch("center.lat",function(e,n){var o=i(a.zoom);r.loaded&&e&&n&&e.toFixed(o)!==n.toFixed(o)&&a.center.lng&&(d&&t.cancel(d),f=e,d=t(function(){r.centerAt([p||a.center.lng,f]),p=null,f=null},500))}),a.$watch("zoom",function(e,t){r.loaded&&e!==t&&r.setZoom(e)}),r.on("extent-change",function(e){o(a,function(){var t,n;a.zoom=r.getZoom(),n=i(a.zoom),r.geographicExtent&&(t=r.geographicExtent.getCenter(),a.center.lng.toFixed(n)!==t.x.toFixed(n)&&(a.center.lng=t.x),a.center.lat.toFixed(n)!==t.y.toFixed(n)&&(a.center.lat=t.y)),u.extentChange&&a.extentChange()(e)})}),a.$on("$destroy",function(){r.destroy()})}),this.getMap=function(){return s.promise},this.addLayer=function(e){return this.getMap().then(function(t){return t.addLayer(e)})},this.addLayerInfo=function(e){this.layerInfos?this.layerInfos.push(e):this.layerInfos=[e]},this.getLayerInfos=function(){return this.layerInfos}}]}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriFeatureLayer",["$q",function(e){return{restrict:"E",require:["esriFeatureLayer","^esriMap"],replace:!0,controller:["$scope","$element","$attrs",function(t,r,n){var o=e.defer();require(["esri/layers/FeatureLayer"],function(e){var t=new e(n.url);o.resolve(t)}),this.getLayer=function(){return o.promise}}],link:function(e,t,r,n){var o=n[0],i=n[1];o.getLayer().then(function(e){return i.addLayer(e),i.addLayerInfo({title:r.title||e.name,layer:e,hideLayers:r.hideLayers?r.hideLayers.split(","):void 0,defaultSymbol:r.defaultSymbol?JSON.parse(r.defaultSymbol):!0}),e})}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriLegend",["$document","$q",function(t,r){return{priority:-10,scope:{},replace:!0,require:["^esriMap"],link:function(t,n,o,i){var a=i[0],c=o.targetId||o.id,u=r.defer();require(["esri/dijit/Legend","dijit/registry"],function(r,n){a.getMap().then(function(o){var i={map:o},s=a.getLayerInfos();s&&(i.layerInfos=s);var l=n.byId(c);l&&l.destroyRecursive(),l=new r(i,c),l.startup(),t.layers=l.layers,e.forEach(t.layers,function(e,r){t.$watch("layers["+r+"].renderer",function(){l.refresh()})}),u.resolve(l)})})}}}])}(angular);